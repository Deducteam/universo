What is Universo?
-----------------

Coq, Agda, Lean, Matita, HOL, etc... can all be seen as extension of one particular Cumulative Type System (CTS). CTS are an extension of Pure Type Systems (PTS) where a subtyping relation is introduced on types. As long as PTS, a CTS can be parameterized by a so-called specification. This specification says what kind of function is allowed to build.

Universo has been built to know whether a judgment of a CTS (and hence PTS) written in one specification can been embedded in another. This tool is today, the cornerstone of the [Logipedia](http://logipedia.inria.fr/) project.

Dedukti [Dedukti](https://github.com/Deducteam/Dedukti) is a Logical Framework, and as such, can be used to encode several systems. Today, Dedukti provides a nice framework to embed CTS and this is why Universo has been built for Dedukti. The counterpart is, that currently, to use Universo, you need first to encode your proofs in Dedukti. Fortunately, at this time, several translations for concrete systems exist and can be effectively used:

- [Krajono](https://github.com/Deducteam/matita/tree/krajono) is an automatic tool that translates Matita's proofs into Dedukti
- [CoqInE](https://github.com/Deducteam/CoqInE) is an automatic tool that translates Coq's proofs into Dedukti (this is still work in progress)
- [Holide](https://github.com/Deducteam/Holide) is an automatic tool to translates OpenTheory's proofs into Dedukti

If your system is not in the list, then three options can be considered:
1. Providing an encoding of your system into Dedukti. In that case, I invite you to contact Gilles Dowek to start a collaboration
2. Extending Universo so that it might be used with your system. In that case, you can write an issue on GitHub
3. Implement the ideas behind Universo in your system. In that case, I invite you to read the documentation since there is no publication yet. You can also write an issue on GitHub or drop me an email if you are interested.

Use cases of Universo
---------------------

Universo has several use cases. Some are detailed below:

- Translate a proof from an expressive CTS to a less expressive CTS
- Knowing if a proof is predicative while it was developped in an impredicative system
- Knowing the minimum number of universes needed by a proof
- Going from an inconsistent system (with Type : Type for example) to a consistent one.

How Universo works
------------------

Universos processes in four steps:

1. First, terms are elaborated to remove all the concrete sort information
2. Second, Dedukti is used to type check the terms which generates constraints.
3. Constraints are solved via a SMT Solver (currently only Z3 is used)
4. We reconstruct the terms via the solution found by Z3

Steps 1,2 and 4 are modular. Step 3 is not modular since it needs all the constraints. Moreover only step 2 needs Dedukti as a type checker, all the other steps could be independent from Dedukti.

For each file `input/A.dk`, Universo will genertate four other files:

-`output/A.dk` where `output` is the output directory given by the user. `output/A.dk` is the same file as `input/A.dk` but universes are elaborated (see [configuration](configuration.md)). In general, it means that universes are replaced by a fresh constant. It is generated by the first step.
- `output/A_univ.dk` contains all the declaration o fresh universes generated before for `output/A.dk`. It is generated by the first step.
- `output/A_cstr.dk` contains the constraint induced by the type checking of universo on file `A.dk`. It is generated by the second step.
- `output/A_sol.dk` contains the solution found by Z3. It is generated by the third step.

Moreover, Universo has the option `--simplify` so that once a solution has been found, all these files are merged into one. See [command line options](options.md) for more explanations.

CTS in Dedukti
--------------

Universo is meant to be used for CTS and some of there extensions such as inductive types. In that way, it does not impose a theory file. However, it has some requirements about the theory file used by the library:

- The public signature should be the one described in [Public Signature](public_signature)
- The private signature should be the one described in [Private Signature](private_signature)

Universo is known to work with inductive types. However, it is unclear if it works well with other extensions such as:

- Universe polymorphism
- Proof irrelevance
- HOTT features

SMT solvers and Z3
------------------

Universo is intented to work with any SMT solver (or any solver that could solve the constraint below). However, only a binding with Z3 is supported. Two logics are supported currently:

- Non-interpreted symbols (`QF` logic)
- Linear arithmetic (`LRA` logic)

On our tests, `LRA` is always faster than `QF` but some CTS specifications does not have an arithmetic interpretation, wheras `QF` supports all the decidable CTS specifications.

For these two logic, the solver can be parameterized with the configuration file (see [configuration](configuration.md)).
